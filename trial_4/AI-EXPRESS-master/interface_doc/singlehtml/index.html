

<!DOCTYPE html>
<html class="writer-html4" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>AI Express用户手册 2.9.0 文档</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html#document-index" class="icon icon-home"> AI Express用户手册
          

          
          </a>

          
            
            
          

          

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-BuildAll/doc/interface_overview">接口概述</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#xstreamsdk">XStream算法SDK编程框架</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#xproto">XProto原型应用开发框架</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-BuildAll/doc/xstream_interface">XStream API文档</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">数据结构体定义</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#datastate">DataState</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#basedata">BaseData</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#basedatavector">BaseDataVector</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#xstreamdata">XStreamData</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#inputparam">InputParam</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#disableparam">DisableParam</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#sdkcommparam">SdkCommParam</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#inputdata">InputData</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#outputdata">OutputData</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">XStream API说明</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#setconfig">SetConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#init">Init</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#setcallback">SetCallback</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#getconfig">GetConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#updateconfig">UpdateConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#syncpredict">SyncPredict</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#syncpredict2">SyncPredict2</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#asyncpredict">AsyncPredict</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#gettasknum">GetTaskNum</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#method-api">Method API说明</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#methodinfo">MethodInfo属性说明</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id3">Method API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="index.html#id4">Init</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#initfromjsonstring">InitFromJsonString</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#finalize">Finalize</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#updateparameter">UpdateParameter</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#getparameter">GetParameter</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#getversion">GetVersion</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#getmethodinfo">GetMethodInfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#doprocess">DoProcess</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-BuildAll/doc/xproto_interface">XProto API文档</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">消息接口介绍</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#id2">统一消息基础类</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#id3">总线消息类型注册接口</a><ul>
<li class="toctree-l4"><a class="reference internal" href="index.html#id4">参数</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#id5">说明</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#plugin">plugin接口介绍</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#xplugin">XPlugin类定义</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#xpluginapi">XPlugin接口API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="index.html#xplugin-init">XPlugin::Init</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xplugin-deinit">XPlugin::DeInit</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xplugin-onmsg">XPlugin::OnMsg</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xplugin-pushmsg">XPlugin::PushMsg</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xplugin-trypushmsg">XPlugin::TryPushMsg</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xplugin-registermsg">XPlugin::RegisterMsg</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xplugin-unregistermsg">XPlugin::UnRegisterMsg</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xplugin-desc">XPlugin::desc</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#xpluginasync">XPluginAsync接口介绍</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#id38">XPluginAsync基础类定义</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#pluginapi">Plugin接口API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="index.html#xpluginasync-init">XPluginAsync::Init</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xpluginasync-start">XPluginAsync::Start</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xpluginasync-stop">XPluginAsync::Stop</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xpluginasync-deinit">XPluginAsync::DeInit</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xpluginasync-getpluginmsgcount">XPluginAsync::GetPluginMsgCount</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xpluginasync-getpluginmsglimit">XPluginAsync::GetPluginMsgLimit</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xpluginasync-setpluginmsglimit">XPluginAsync::SetPluginMsgLimit</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xpluginasync-getmsgmonitortime">XPluginAsync::GetMsgMonitorTime</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xpluginasync-setmsgmonitortime">XPluginAsync::SetMsgMonitorTime</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xpluginasync-pushmsg">XPluginAsync::PushMsg</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xpluginasync-trypushmsg">XPluginAsync::TryPushMsg</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xpluginasync-registermsg">XPluginAsync::RegisterMsg</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xpluginasync-unregistermsg">XPluginAsync::UnRegisterMsg</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#xpluginasync-desc">XPluginAsync::desc</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html#document-index">AI Express用户手册</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html#document-index" class="icon icon-home"></a> &raquo;</li>
        
      <li>AI Express用户手册 2.9.0 文档</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ai-express-v2-8-0">
<h1>AI Express接口文档(V2.8.0)<a class="headerlink" href="#ai-express-v2-8-0" title="永久链接至标题">¶</a></h1>
</div>
<div class="section" id="id1">
<h1>目录结构<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<div class="toctree-wrapper compound">
<span id="document-BuildAll/doc/interface_overview"></span><div class="section" id="id1">
<h2>接口概述<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>AI Express，中文名称AI应用开发中间件，是地平线芯片“天工开物”（Horizon OpenExplorer™️ Platform）AI开发平台的一部分。</p>
<p>AI Express包含两套框架，分别为<strong>XStream开发框架</strong>，<strong>XProto原型框架</strong>。</p>
<ul class="simple">
<li>XStream: 一套独立的算法SDK编程框架。将预测任务拆分到一系列Method中，提供能力将Method串联成Graph，完成基于Graph的计算。可以根据不同的业务场景(不同的workflow)，快速生成对应的预测SDK。</li>
<li>XProto: 一套独立的原型应用开发框架。该框架将整个应用划分成一系列的Plugin，各个Plugin之间通过消息总线通信，完成了模块的解耦、复用、可扩展等需求。</li>
</ul>
<div class="section" id="xstreamsdk">
<h3>XStream算法SDK编程框架<a class="headerlink" href="#xstreamsdk" title="永久链接至标题">¶</a></h3>
<p>XStream属于一套算法SDK编程框架，Method为框架核心组件，以Graph的方式将Method实例串联起来，XStream框架内部自动完成Method的调度。框架核心为XStream-Framework。</p>
<ul class="simple">
<li>XStream-Framework: XStream算法SDK编程框架，定义了最基础的数据类型定义以及Method的定义；完成Graph的构建以及调度；提供C++接口，支持同步预测/异步预测等功能；支持多路输入、多路输出、子workflow、Profiler、Node输出回调、Method运行参数控制、超时预警等特性。</li>
</ul>
</div>
<div class="section" id="xproto">
<h3>XProto原型应用开发框架<a class="headerlink" href="#xproto" title="永久链接至标题">¶</a></h3>
<p>XProto原型应用开发框架是一套基于消息总线交互的可扩展框架，框架定义了基础的消息类型、Plugin基础类定义以及消息发布订阅的处理逻辑。开发者通过开发Plugin，以及这些Plugin之间交互的消息，降低了模块的耦合。框架核心为XProto-Framework。</p>
<ul class="simple">
<li>XProto-Framework: 一种简易的消息发布订阅开发框架，定义了消息基础类以及可扩展插件Plugin。Plugin之间通过消息总线通信，Plugin可以向总线发布消息，也可以从总线上订阅感兴趣的类型的消息。框架负责消息的订阅分发。</li>
</ul>
</div>
</div>
<span id="document-BuildAll/doc/xstream_interface"></span><div class="section" id="xstream-api">
<h2>XStream API文档<a class="headerlink" href="#xstream-api" title="永久链接至标题">¶</a></h2>
<div class="section" id="id1">
<h3>数据结构体定义<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<p>本节内容描述XStream API接口中需要的数据结构。</p>
<div class="section" id="datastate">
<h4>DataState<a class="headerlink" href="#datastate" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="k">class</span> <span class="nc">DataState</span> <span class="p">{</span>
  <span class="c1">/// valid</span>
  <span class="n">VALID</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
  <span class="c1">/// filtered</span>
  <span class="n">FILTERED</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
  <span class="c1">/// invisible</span>
  <span class="n">INVISIBLE</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
  <span class="c1">/// disappeared</span>
  <span class="n">DISAPPEARED</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
  <span class="c1">/// invalid</span>
  <span class="n">INVALID</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</div>
<p>描述：</p>
<p>DataState定义了数据的几种基本状态。在业务开发过程中，对数据处理时，可能会依赖这些状态。数据正常有效，应该设置为VALID。</p>
</div>
<hr class="docutils" />
<div class="section" id="basedata">
<h4>BaseData<a class="headerlink" href="#basedata" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">BaseData</span> <span class="p">{</span>
  <span class="n">BaseData</span><span class="p">();</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">BaseData</span><span class="p">();</span>
  <span class="c1">/// type</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">type_</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
  <span class="c1">/// name</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name_</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
  <span class="c1">/// error code</span>
  <span class="kt">int</span> <span class="n">error_code_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">/// error detail info</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">error_detail_</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
  <span class="c1">/// context of C structure</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">CContext</span><span class="o">&gt;</span> <span class="n">c_data_</span><span class="p">;</span>
  <span class="c1">/// data status</span>
  <span class="n">DataState</span> <span class="n">state_</span> <span class="o">=</span> <span class="n">DataState</span><span class="o">::</span><span class="n">VALID</span><span class="p">;</span>

  <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">BaseData</span><span class="o">&gt;</span> <span class="n">BaseDataPtr</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>描述：</p>
<p>BaseData结构体描述了框架内部数据流的基本信息。<strong>Method之间传递的数据，必须是从BaseData派生出来</strong>。BaseData数据成员包括：</p>
<ul class="simple">
<li>数据类型type_: 用户自定义数据的描述信息，如”box”等，该字段当前无特殊作用，可不关注；</li>
<li>数据名称name_: 数据的别名。框架运行过程中，会将数据的name_赋值为workflow配置文件中配置的名字。对于InputData，需要外部指定数据的name_,指定的name_需要和workflow配置中配置的名字一致；</li>
<li>错误码error_code_: 数据错误码；</li>
<li>错误信息error_detail_: 错误信息描述；</li>
<li>CContext c_data_: 扩展的C数据结构，可不关注；</li>
<li>数据状态state_: 该数据的状态，默认为有效。</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="basedatavector">
<h4>BaseDataVector<a class="headerlink" href="#basedatavector" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="nl">BaseDataVector</span> <span class="p">:</span> <span class="k">public</span> <span class="n">BaseData</span> <span class="p">{</span>
  <span class="n">BaseDataVector</span><span class="p">();</span>

  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">BaseDataPtr</span><span class="o">&gt;</span> <span class="n">datas_</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>描述：</p>
<p>BaseDataVector为BaseData的一个派生类，用于表示数组类数据，比如保存一帧图像中的所有的人体检测框，datas_数组中每个成员指向一个人体检测框数据。</p>
<ul class="simple">
<li>datas_: 用于保存数组中每个值。</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="xstreamdata">
<h4>XStreamData<a class="headerlink" href="#xstreamdata" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">/// Wrap other data structures into derived classes of BaseData</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Dtype</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="nl">XStreamData</span> <span class="p">:</span> <span class="k">public</span> <span class="n">BaseData</span> <span class="p">{</span>
  <span class="n">Dtype</span> <span class="n">value</span><span class="p">;</span>
  <span class="n">XStreamData</span><span class="p">()</span> <span class="p">{}</span>
  <span class="k">explicit</span> <span class="n">XStreamData</span><span class="p">(</span><span class="k">const</span> <span class="n">Dtype</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="n">value</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>描述：</p>
<p>XStreamData用于将其他非BaseData继承的数据结构，通过模板类封装，封装后的具体类继承自BaseData，可以用于Method之间数据传递。</p>
<p>封装后的具体类包含一个成员value，用于保存原始数据结构的值。</p>
</div>
<hr class="docutils" />
<div class="section" id="inputparam">
<h4>InputParam<a class="headerlink" href="#inputparam" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">InputParam</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">explicit</span> <span class="n">InputParam</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">unique_name</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">unique_name_</span> <span class="o">=</span> <span class="n">unique_name</span><span class="p">;</span>
    <span class="n">is_json_format_</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">is_enable_this_method_</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">InputParam</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Format</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

 <span class="k">public</span><span class="o">:</span>
  <span class="kt">bool</span> <span class="n">is_json_format_</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">is_enable_this_method_</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">unique_name_</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">InputParam</span><span class="o">&gt;</span> <span class="n">InputParamPtr</span><span class="p">;</span>
</pre></div>
</div>
<p>描述：</p>
<p>InputParam是输入数据参数的数据结构。包括：</p>
<ul class="simple">
<li>unique_name_：表示该参数作用在具体节点的唯一性标识，对应workflow配置中的Method名字。</li>
<li>is_json_format_：表示输入参数是否是json字符串。若是，可以通过Format()接口获取json字符串；</li>
<li>is_enable_this_method_：表示是否使能该节点。若为true，则将本参数传递入节点，且节点正常运算；若为false，则跳过该节点运算。</li>
</ul>
<p>当准备InputData时，可以通过InputParam，更新Method的配置参数。用户可以继承该类，定义具体的参数类型，然后相关的Method使用新定义的数据类型解析配置参数。</p>
</div>
<hr class="docutils" />
<div class="section" id="disableparam">
<h4>DisableParam<a class="headerlink" href="#disableparam" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DisableParam</span> <span class="o">:</span> <span class="k">public</span> <span class="n">InputParam</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">enum</span> <span class="k">class</span> <span class="nc">Mode</span> <span class="p">{</span>
    <span class="c1">/// passthrough mode: use inputdata as outputdata;</span>
    <span class="c1">/// slot size of outputdata and inputdata must be equal;</span>
    <span class="n">PassThrough</span><span class="p">,</span>
    <span class="c1">/// use pre-difined data as outputdata;</span>
    <span class="c1">/// slot size of predifine data and outputdata must be equal;</span>
    <span class="n">UsePreDefine</span><span class="p">,</span>
    <span class="c1">/// set outputdata status as DataState::INVALID</span>
    <span class="n">Invalid</span><span class="p">,</span>
    <span class="c1">/// flexibly passthrough mode</span>
    <span class="c1">/// 1. passthrough inputdata to outputdata in order</span>
    <span class="c1">/// 2. if slot size of inputdata greater than outputdata,</span>
    <span class="c1">///    only use the first few slots.</span>
    <span class="c1">/// 3. if slot size of inputdata less than outputdata,</span>
    <span class="c1">///    set status of last few slots invalid.</span>
    <span class="n">BestEffortPassThrough</span>
  <span class="p">};</span>
  <span class="k">explicit</span> <span class="nf">DisableParam</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">unique_name</span><span class="p">,</span>
                        <span class="n">Mode</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">Mode</span><span class="o">::</span><span class="n">Invalid</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">InputParam</span><span class="p">(</span><span class="n">unique_name</span><span class="p">),</span> <span class="n">mode_</span><span class="p">{</span><span class="n">mode</span><span class="p">}</span> <span class="p">{</span>
    <span class="n">is_enable_this_method_</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">DisableParam</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Format</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">unique_name_</span> <span class="o">+</span> <span class="s">&quot; : disabled&quot;</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">Mode</span> <span class="n">mode_</span><span class="p">;</span>
  <span class="c1">/// pre-difined data, used in Mode::UsePreDefine</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">BaseDataPtr</span><span class="o">&gt;</span> <span class="n">pre_datas_</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">DisableParam</span><span class="o">&gt;</span> <span class="n">DisableParamPtr</span><span class="p">;</span>
</pre></div>
</div>
<p>描述：</p>
<p>DisableParam继承自InputParam，用于workflow节点旁路控制：</p>
<ul class="simple">
<li>mode_：指定节点旁路的模式，具体模式说明可以参考用户文档或者xstream tutorials。</li>
<li>pre_datas__：UsePreDefine模式，使用用户传入的值代替节点的输出值</li>
</ul>
<p>当准备InputData时，可以通过设置DisableParam，临时跳过一些节点的计算。</p>
</div>
<hr class="docutils" />
<div class="section" id="sdkcommparam">
<h4>SdkCommParam<a class="headerlink" href="#sdkcommparam" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SdkCommParam</span> <span class="o">:</span> <span class="k">public</span> <span class="n">InputParam</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">SdkCommParam</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">unique_name</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">param</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">InputParam</span><span class="p">(</span><span class="n">unique_name</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">param_</span> <span class="o">=</span> <span class="n">param</span><span class="p">;</span>
    <span class="n">is_json_format_</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Format</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">param_</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">SdkCommParam</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

 <span class="k">public</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">param_</span><span class="p">;</span>  <span class="c1">// json format</span>
<span class="p">};</span>
<span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">SdkCommParam</span><span class="o">&gt;</span> <span class="n">CommParamPtr</span><span class="p">;</span>
</pre></div>
</div>
<p>描述：</p>
<p>SdkCommParam继承自InputParam，常规的json方式描述参数。通过调用Format接口获取json字符串。</p>
</div>
<hr class="docutils" />
<div class="section" id="inputdata">
<h4>InputData<a class="headerlink" href="#inputdata" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">InputData</span> <span class="p">{</span>
  <span class="c1">/// input data, such as image, timestamp, box..</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">BaseDataPtr</span><span class="o">&gt;</span> <span class="n">datas_</span><span class="p">;</span>
  <span class="c1">/// InputParam</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">InputParamPtr</span><span class="o">&gt;</span> <span class="n">params_</span><span class="p">;</span>
  <span class="c1">/// input_data source id, used in multi-input; default value 0(single-input)</span>
  <span class="kt">uint32_t</span> <span class="n">source_id_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">/// context_ pasthroughed to OutputData::context_</span>
  <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">context_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>描述：</p>
<p>InputData结构体描述了框架的输入数据流基本信息。包括：</p>
<ul class="simple">
<li>数据流datas_：BaseData数组，表示一帧计算输入的数据；</li>
<li>参数params_：InputParam数组，注意参数params_和输入数据datas_无位置对应关系，InputParam中有成员描述该InputParam配置具体对应到哪个Method；</li>
<li>输入源source_id_：输入源编号，表示输入源的唯一标志，多输入源从0开始编号，单输入源默认为0，用于支持多路；</li>
<li>透传数据context_：透传数据，该数据会透传到OutputData，可用于业务特殊需求。</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="outputdata">
<h4>OutputData<a class="headerlink" href="#outputdata" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">OutputData</span> <span class="p">{</span>
  <span class="c1">/// error code</span>
  <span class="kt">int</span> <span class="n">error_code_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">/// error info</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">error_detail_</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
  <span class="c1">/// used in Node&#39;s outputdata, represents node&#39;s name</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">unique_name_</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
  <span class="c1">/// outputdata name</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">output_type_</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
  <span class="c1">/// output data, such as detection_box, landmarks..</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">BaseDataPtr</span><span class="o">&gt;</span> <span class="n">datas_</span><span class="p">;</span>
  <span class="c1">/// passthroughed from inputdata</span>
  <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">context_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
  <span class="c1">/// sequence_id in single-input</span>
  <span class="kt">int64_t</span> <span class="n">sequence_id_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">/// input_data source id, used in multi-input; default value 0(single-input)</span>
  <span class="kt">uint32_t</span> <span class="n">source_id_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">uint64_t</span> <span class="n">global_sequence_id_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>描述：</p>
<p>OutputData结构体描述了框架的输出数据流基本信息。包括：</p>
<ul class="simple">
<li>error_code_：表示错误码，非0表示预测出现错误；</li>
<li>error_detail_：表示错误描述信息；</li>
<li>unique_name_：表示该输出数据是某具体节点的输出数据，unique_name_对应workflow配置中产生该数据的Method的名字；</li>
<li>output_type_：多路输出中表示该组输出数据的名称，单路输出时默认是”<strong>NODE_WHOLE_OUTPUT</strong>”；</li>
<li>datas_：表示一帧预测计算的所有输出数据；</li>
<li>context_：透传字段，由该帧数据的输入数据InputData.context_传入；</li>
<li>sequence_id_: 表示该输出数据对应输入源的输入帧的序列号，从0开始依次累加；</li>
<li>source_id_: 表示多输入源情况下输入源的编号；</li>
<li>global_sequence_id_: 表示多输入源情况下，对应输入帧的总序列号；单输入源情况下，与sequence_id_相同。</li>
</ul>
</div>
</div>
<div class="section" id="id2">
<h3>XStream API说明<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<div class="section" id="setconfig">
<h4>SetConfig<a class="headerlink" href="#setconfig" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">SetConfig</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">key</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<ul>
<li><p class="first">描述：用于设置整个workflow的配置，目前支持的配置有workflow配置文件、性能统计profiler相关功能、超时告警以及帧内中间数据的释放。</p>
</li>
<li><p class="first">输入：</p>
<p>1）key为”config_file”，value设置为workflow的配置文件路径，它定义整个workflow数据流。</p>
<p>2）key为”profiler”，value为”on”，表示打开性能统计功能。”off”表示关闭, 默认为关闭。</p>
<p>3）key为”profiler_file”,value为性能统计输出文件路径，用于设置性能统计文件的路径名称。当打开性能统计功能，需要设置输出文件路径。</p>
<p>4）key为”profiler_time_interval”,value为统计耗时的最小时间间隔，单位为微秒。若某处统计的耗时小于value，则此耗时记录不会添加到性能统计结果。默认值是3000微秒，即3毫秒。</p>
<p>5）key为”profiler_fps_interval”,value为统计帧率的最小时间间隔，单位为微秒。若某处统计Fps的耗时小于value，则此fps记录不会添加到性能统计结果。默认200*1000微秒，即200毫秒。</p>
<p>6）key为”free_framedata”, value为”on”, 表示尽早地释放掉在后面node节点中不再需要使用的框架中的某项中间数据，打开此项配置,可以减少峰值内存使用。默认关闭。</p>
<p>7）key为”time_monitor”, value为输入框架的每帧数据处理的最大时长, 单位毫秒。设置value非0，则打开超时告警功能。value默认为0，即关闭超时告警功能。</p>
</li>
<li><p class="first">返回：接口返回0表示设置成功，返回-1表示设置失败；</p>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="init">
<h4>Init<a class="headerlink" href="#init" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">Init</span><span class="p">();</span>
</pre></div>
</div>
<ul class="simple">
<li>描述：用于初始化XStream对象，注意必须在调用SetConfig之后执行Init()。</li>
<li>返回：接口返回0表示初始化成功，否则表示初始化失败。</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="setcallback">
<h4>SetCallback<a class="headerlink" href="#setcallback" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="n">OutputDataPtr</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">XStreamCallback</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">SetCallback</span><span class="p">(</span><span class="n">XStreamCallback</span> <span class="n">callback</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
</pre></div>
</div>
<ul>
<li><p class="first">描述：用于回调函数的设置，用于异步预测的使用。使用同步接口时，该接口无效。注意必须在调用Init后执行SetCallback，否则节点等信息还未完善，设置回调函数会失败。</p>
</li>
<li><p class="first">输入：</p>
<p>1）callback：表示设置的回调函数。</p>
<p>2）name: 默认为空，表示设置整个workflow的输出数据的回调函数；当name设置为某个节点的unique名字，设置该节点输出数据的回调函数。</p>
</li>
<li><p class="first">返回：接口返回0表示设置成功，否则表示设置失败；</p>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="getconfig">
<h4>GetConfig<a class="headerlink" href="#getconfig" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">InputParamPtr</span> <span class="nf">GetConfig</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">unique_name</span><span class="p">);</span>
</pre></div>
</div>
<ul>
<li><p class="first">描述：获取某个节点的参数。</p>
</li>
<li><p class="first">输入：</p>
<p>1）unique_name: 某个节点的unique名字（对应workflow配置中的节点名字），表示获取该节点的参数</p>
</li>
<li><p class="first">返回：InputParamPtr</p>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="updateconfig">
<h4>UpdateConfig<a class="headerlink" href="#updateconfig" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">UpdateConfig</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">unique_name</span><span class="p">,</span> <span class="n">InputParamPtr</span> <span class="n">ptr</span><span class="p">);</span>
</pre></div>
</div>
<ul>
<li><p class="first">描述：用于设置或更新节点的参数。</p>
</li>
<li><p class="first">输入：</p>
<p>1）unique_name: 某个节点的unique名字（对应workflow配置中的节点名字），表示更新或设置该节点的参数。</p>
<p>2）ptr：更新的参数信息。</p>
</li>
<li><p class="first">返回：返回0表示参数更新成功，否则失败。</p>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="syncpredict">
<h4>SyncPredict<a class="headerlink" href="#syncpredict" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">OutputDataPtr</span> <span class="nf">SyncPredict</span><span class="p">(</span><span class="n">InputDataPtr</span> <span class="n">input</span><span class="p">);</span>
</pre></div>
</div>
<ul>
<li><p class="first">描述：同步运行接口，传⼊数据，接口会阻塞住，直到整个workflow处理完成，将workflow的输出结果通过函数返回值返回。</p>
</li>
<li><p class="first">输入：</p>
<p>1）input: 待处理的输入数据，需要用户自己封装。</p>
</li>
<li><p class="first">返回：返回OutputDataPtr，输出workflow的输出结果。</p>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="syncpredict2">
<h4>SyncPredict2<a class="headerlink" href="#syncpredict2" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">OutputDataPtr</span><span class="o">&gt;</span> <span class="n">SyncPredict2</span><span class="p">(</span><span class="n">InputDataPtr</span> <span class="n">input</span><span class="p">);</span>
</pre></div>
</div>
<ul>
<li><p class="first">描述：用于多组输出的同步运行接口，传⼊数据，接口会阻塞住，直到整个workflow处理完成，将workflow的输出结果通过函数返回值返回。</p>
</li>
<li><p class="first">输入：</p>
<p>1）input: 待处理的输入数据，需要用户自己封装。</p>
</li>
<li><p class="first">返回：返回OutputDataPtr数组，输出workflow的多组输出结果。</p>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="asyncpredict">
<h4>AsyncPredict<a class="headerlink" href="#asyncpredict" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int64_t</span> <span class="nf">AsyncPredict</span><span class="p">(</span><span class="n">InputDataPtr</span> <span class="n">input</span><span class="p">);</span>
</pre></div>
</div>
<ul>
<li><p class="first">描述：异步运行接口，AsyncPredict接口调用后立即返回，workflow的输出结果通过回调函数处理。</p>
</li>
<li><p class="first">输入：</p>
<p>1）input: 待处理的输入数据，需要用户自己封装。</p>
</li>
<li><p class="first">返回：接口返回值大于等于0，则表示该任务成功加入队列，且返回码表示该路输入源的sequence_id；若接口返回值小于0，表示任务队列已满，添加任务失败。</p>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="gettasknum">
<h4>GetTaskNum<a class="headerlink" href="#gettasknum" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int64_t</span> <span class="nf">GetTaskNum</span><span class="p">();</span>
</pre></div>
</div>
<ul class="simple">
<li>描述：用于获取框架中当前任务队列的长度，即未完成的任务数量。</li>
<li>返回：返回未完成的任务数量。</li>
</ul>
</div>
</div>
<div class="section" id="method-api">
<h3>Method API说明<a class="headerlink" href="#method-api" title="永久链接至标题">¶</a></h3>
<div class="section" id="methodinfo">
<h4>MethodInfo属性说明<a class="headerlink" href="#methodinfo" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">MethodInfo</span> <span class="p">{</span>
  <span class="c1">/// is thread safe</span>
  <span class="kt">bool</span> <span class="n">is_thread_safe_</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="c1">/// is need reorder, the order of outputdata must be same as the inputdata</span>
  <span class="kt">bool</span> <span class="n">is_need_reorder</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="c1">/// is dependent on inputdata source</span>
  <span class="kt">bool</span> <span class="n">is_src_ctx_dept</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>描述：</p>
<p>MethodInfo结构体定义了Method的属性信息，包括：</p>
<ul class="simple">
<li>is_thread_safe_: Method是否为线程安全，默认值是false。在Workflow定义时候，支持配置Node的线程数。如果线程数配置大于1，若Method的计算过程是非线程安全的，则多线程下会定义多个Method实例；否则多线程复用一个Method实例。</li>
<li>is_need_reorder: 是否要求数据按顺逐帧调用Method处理。比如一些目标跟踪场景，要求输出数据是有序的。默认是false，表示不要求有序。<strong>注意：在is_need_reorder=true的method，由于有前后帧序依赖，线程数只允许为1</strong>。同时is_need_reorder=true会一定程度上降低执行效率。</li>
<li>is_src_ctx_dept: 对输入数据的处理是否依赖输入源。比如目标跟踪场景，会记录前几帧数据并分配track_id，这类Method需要将属性设置为<code class="docutils literal notranslate"><span class="pre">is_src_ctx_dept</span> <span class="pre">=</span> <span class="pre">true</span></code>。</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="id3">
<h4>Method API<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<div class="section" id="id4">
<h5>Init<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">Init</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">config_file_path</span><span class="p">);</span>
</pre></div>
</div>
<ul>
<li><p class="first">描述：Method的初始化函数，一般包括配置文件的加载、配置参数的获取，关键变量的设置等。</p>
</li>
<li><p class="first">输入：</p>
<p>1）config_file_path: Method对应的配置文件路径。</p>
</li>
<li><p class="first">返回：接口返回0表示初始化成功，否则表示初始化失败；</p>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="initfromjsonstring">
<h5>InitFromJsonString<a class="headerlink" href="#initfromjsonstring" title="永久链接至标题">¶</a></h5>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">InitFromJsonString</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">config</span><span class="p">);</span>
</pre></div>
</div>
<ul>
<li><p class="first">描述：Method的初始化函数，与Init函数的区别在于，传入的参数是Json格式的配置内容，而非文件路径。</p>
</li>
<li><p class="first">输入：</p>
<p>config: Method对应的配置内容，Json格式。</p>
</li>
<li><p class="first">返回：接口返回0表示初始化成功，否则表示初始化失败；</p>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="finalize">
<h5>Finalize<a class="headerlink" href="#finalize" title="永久链接至标题">¶</a></h5>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">Finalize</span><span class="p">();</span>
</pre></div>
</div>
<ul class="simple">
<li>描述：Method对象销毁前需要处理的内容，包括关键变量的释放等。</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="updateparameter">
<h5>UpdateParameter<a class="headerlink" href="#updateparameter" title="永久链接至标题">¶</a></h5>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">UpdateParameter</span><span class="p">(</span><span class="n">InputParamPtr</span> <span class="n">ptr</span><span class="p">);</span>
</pre></div>
</div>
<ul>
<li><p class="first">描述：更新Method的参数。</p>
</li>
<li><p class="first">输入：</p>
<p>ptr: 待更新的参数；</p>
</li>
<li><p class="first">返回：接口返回0表示更新成功，否则表示更新失败；</p>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="getparameter">
<h5>GetParameter<a class="headerlink" href="#getparameter" title="永久链接至标题">¶</a></h5>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">InputParamPtr</span> <span class="nf">GetParameter</span><span class="p">();</span>
</pre></div>
</div>
<ul class="simple">
<li>描述：获取Method的参数。</li>
<li>返回：接口返回InputParam。</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="getversion">
<h5>GetVersion<a class="headerlink" href="#getversion" title="永久链接至标题">¶</a></h5>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetVersion</span><span class="p">();</span>
</pre></div>
</div>
<ul class="simple">
<li>描述：获取Method的版本信息。</li>
<li>返回：接口返回Method的版本信息。</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="getmethodinfo">
<h5>GetMethodInfo<a class="headerlink" href="#getmethodinfo" title="永久链接至标题">¶</a></h5>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">MethodInfo</span> <span class="nf">GetMethodInfo</span><span class="p">();</span>
</pre></div>
</div>
<ul class="simple">
<li>描述：获取Method的属性信息。</li>
<li>返回：接口返回Method的属性信息MethodInfo。</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="doprocess">
<h5>DoProcess<a class="headerlink" href="#doprocess" title="永久链接至标题">¶</a></h5>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">BaseDataPtr</span><span class="o">&gt;&gt;</span> <span class="n">DoProcess</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">BaseDataPtr</span><span class="o">&gt;&gt;</span> <span class="o">&amp;</span><span class="n">input</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">InputParamPtr</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">param</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li>描述：Method的核心处理函数。</li>
<li>输入：
1）input：表示待处理的数据，input[i]表示Batch i的数据，目前仅支持i=0。
2）param：表示Method的参数，param[i]表示处理Batch i数据的参数。</li>
<li>返回：接口返回Method的输出结果output，output[i]表示Batch i的输出数据。</li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-BuildAll/doc/xproto_interface"></span><div class="section" id="xproto-api">
<h2>XProto API文档<a class="headerlink" href="#xproto-api" title="永久链接至标题">¶</a></h2>
<div class="section" id="id1">
<h3>消息接口介绍<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<p>plugin之间交互的方式消息总线分发机制，需要定义了统一的消息接口，实现统一接口的消息被总线分发给对应的plugin。</p>
<div class="section" id="id2">
<h4>统一消息基础类<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>消息基础类XProtoMessage：</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="nl">XProtoMessage</span> <span class="p">:</span> <span class="k">public</span> <span class="n">std</span><span class="o">::</span><span class="n">enable_shared_from_this</span><span class="o">&lt;</span><span class="n">XProtoMessage</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="n">XProtoMessage</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">XProtoMessage</span> <span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">XProtoMessage</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">type_</span> <span class="o">=</span> <span class="s">&quot;NONE&quot;</span><span class="p">;</span>

  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">param_</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>

  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">type</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">type_</span><span class="p">;</span> <span class="p">}</span>

  <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Serialize</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">virtual</span> <span class="kt">void</span> <span class="o">*</span><span class="nf">ConvertData</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// need call delete() to release the output</span>
    <span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="k">using</span> <span class="n">XProtoMessagePtr</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">XProtoMessage</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p>描述：</p>
<p>新Message需要继承XProtoMessage，定义自己的消息类，XProtoMessage描述了消息属性及功能函数，包括：</p>
<ul class="simple">
<li>type_: 消息类型</li>
<li>param_: 消息附加参数信息</li>
<li>type(): 获取消息的类型</li>
<li>Serialize(): 新的消息类型需实现此接口，实现序列化操作，比如实现protobuf的序列化</li>
<li>ConvertData(): 消息转换成指定的数据结构，常用于特殊需求中</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="id3">
<h4>总线消息类型注册接口<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<p><strong>XPLUGIN_REGISTER_MSG_TYPE(<em>MSG_TYPE</em>)</strong></p>
<div class="section" id="id4">
<h5>参数<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>MSGTYPE: 消息类型</li>
</ul>
</div>
<div class="section" id="id5">
<h5>说明<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>总线消息除了实现统一接口，还需要向总线注册其消息类型. 每一类消息都有一个字符串形式的消息类型和结构体来表示.
该接口为一个宏, 参数<em>MSG_TYPE</em>用来表示声明的消息类型, 需要直接使用标识符的格式书写, 宏内部会将其转成字符串.
<strong>注意</strong>: 需要在消费者Plugin调用订阅消息接口之前调用该接口声明消息类型,一般将该宏放在全局变量声明的位置.</p>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="plugin">
<h3>plugin接口介绍<a class="headerlink" href="#plugin" title="永久链接至标题">¶</a></h3>
<p>实现了两个基础类XPlugin和XPluginAsync，实现自定义plugin只需要继承其中任意一个，建议选择XPluginAsync类.
两个基础类有些差异，说明如下：</p>
<ul class="simple">
<li>XPluginAsync是XPlugin的子类,XPluginAsync内部实现了消息的异步处理机制。</li>
<li>XPlugin提供了消息分发、获取&amp;设置msg数量上限、获取&amp;设置msg处理超时时间等接口，子类实现相应接口实现plugin功能.</li>
<li>XPluginAsync继承自XPlugin，实现了消息分发、流量控制、消息处理超时监控等功能，子类只需关注plugin的自身功能.</li>
</ul>
<div class="section" id="xplugin">
<h4>XPlugin类定义<a class="headerlink" href="#xplugin" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">XPlugin</span> <span class="o">:</span> <span class="k">public</span> <span class="n">std</span><span class="o">::</span><span class="n">enable_shared_from_this</span><span class="o">&lt;</span><span class="n">XPlugin</span><span class="o">&gt;</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">XPlugin</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">XPlugin</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="c1">// 完成register msg和workflow的初始化操作</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">Init</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">DeInit</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 处理register的msg类型，如有需要，push自己的msg到总线</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">OnMsg</span><span class="p">(</span><span class="n">XProtoMessagePtr</span> <span class="n">msg</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">desc</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;XPlugin&quot;</span><span class="p">;</span>
  <span class="p">}</span>

 <span class="k">protected</span><span class="o">:</span>
  <span class="c1">// 向总线注册监听消息类型</span>
  <span class="kt">void</span> <span class="n">RegisterMsg</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">type</span><span class="p">);</span>
  <span class="c1">// 卸载监听消息类型</span>
  <span class="kt">void</span> <span class="nf">UnRegisterMsg</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">type</span><span class="p">);</span>
  <span class="c1">// 向总线推送消息</span>
  <span class="kt">void</span> <span class="nf">PushMsg</span><span class="p">(</span><span class="n">XProtoMessagePtr</span> <span class="n">msg</span><span class="p">);</span>
  <span class="c1">// 向总线推送消息</span>
  <span class="kt">int</span> <span class="nf">TryPushMsg</span><span class="p">(</span><span class="n">XProtoMessagePtr</span> <span class="n">msg</span><span class="p">);</span>
<span class="p">};</span>
<span class="k">using</span> <span class="n">XPluginPtr</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">XPlugin</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="xpluginapi">
<h4>XPlugin接口API<a class="headerlink" href="#xpluginapi" title="永久链接至标题">¶</a></h4>
<hr class="docutils" />
<div class="section" id="xplugin-init">
<h5>XPlugin::Init<a class="headerlink" href="#xplugin-init" title="永久链接至标题">¶</a></h5>
<div class="section" id="id6">
<h6>定义<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h6>
<p><strong>virtual int Init() = 0;</strong></p>
</div>
<div class="section" id="id7">
<h6>参数<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id8">
<h6>返回值<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>0: 成功</li>
<li>非0: 失败</li>
</ul>
</div>
<div class="section" id="id9">
<h6>说明<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h6>
<p>初始化Plugin：该接口需要继承<code class="docutils literal notranslate"><span class="pre">XPlugin</span></code>类的自定义Plugin实现该接口定义. 该接口用来初始化Plugin.
自定义Plugin一般在该接口内调用<em>订阅消息</em>接口.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xplugin-deinit">
<h5>XPlugin::DeInit<a class="headerlink" href="#xplugin-deinit" title="永久链接至标题">¶</a></h5>
<div class="section" id="id10">
<h6>定义<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h6>
<p><strong>int XPlugin::DeInit() = 0;</strong></p>
</div>
<div class="section" id="id11">
<h6>参数<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id12">
<h6>返回值<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>0: 成功</li>
<li>非0: 失败</li>
</ul>
</div>
<div class="section" id="id13">
<h6>说明<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h6>
<p>反初始化Plugin：该接口需要继承<code class="docutils literal notranslate"><span class="pre">XPlugin</span></code>类的自定义Plugin实现该接口定义. 该接口用来反初始化Plugin.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xplugin-onmsg">
<h5>XPlugin::OnMsg<a class="headerlink" href="#xplugin-onmsg" title="永久链接至标题">¶</a></h5>
<div class="section" id="id14">
<h6>定义<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h6>
<p><strong>virtual void OnMsg(XProtoMessagePtr <em>msg</em>) = 0;</strong></p>
</div>
<div class="section" id="id15">
<h6>参数<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>XProtoMessagePtr <em>msg</em>: 总线消息.</li>
</ul>
</div>
<div class="section" id="id16">
<h6>返回值<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id17">
<h6>说明<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h6>
<p>处理总线消息：该接口需要继承<code class="docutils literal notranslate"><span class="pre">XPlugin</span></code>类的自定义Plugin实现该接口定义. 该接口接收处理总线消息，接口中不能block时间过长.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xplugin-pushmsg">
<h5>XPlugin::PushMsg<a class="headerlink" href="#xplugin-pushmsg" title="永久链接至标题">¶</a></h5>
<div class="section" id="id18">
<h6>定义<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h6>
<p><strong>void XPlugin::PushMsg(XProtoMessagePtr <em>msg</em>);</strong></p>
</div>
<div class="section" id="id19">
<h6>参数<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>XProtoMessagePtr <em>msg</em>: 发布到总线的消息.</li>
</ul>
</div>
<div class="section" id="id20">
<h6>返回值<a class="headerlink" href="#id20" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id21">
<h6>说明<a class="headerlink" href="#id21" title="永久链接至标题">¶</a></h6>
<p>发布消息：该接口用来将消息发布到XProto内部总线上，如果消息拥塞，将等待通道畅通后发布消息. 接收一个类型为<code class="docutils literal notranslate"><span class="pre">XProtoMessage</span></code>的结构体指针, XProto的所有消息都继承于该类型.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xplugin-trypushmsg">
<h5>XPlugin::TryPushMsg<a class="headerlink" href="#xplugin-trypushmsg" title="永久链接至标题">¶</a></h5>
<div class="section" id="id22">
<h6>定义<a class="headerlink" href="#id22" title="永久链接至标题">¶</a></h6>
<p><strong>void XPlugin::TryPushMsg(XProtoMessagePtr <em>msg</em>);</strong></p>
</div>
<div class="section" id="id23">
<h6>参数<a class="headerlink" href="#id23" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>XProtoMessagePtr <em>msg</em>: 发布到总线的消息.</li>
</ul>
</div>
<div class="section" id="id24">
<h6>返回值<a class="headerlink" href="#id24" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id25">
<h6>说明<a class="headerlink" href="#id25" title="永久链接至标题">¶</a></h6>
<p>发布消息：该接口尝试将消息发布到XProto内部总线上，如果消息拥塞，则丢弃消息立即返回. 接收一个类型为<code class="docutils literal notranslate"><span class="pre">XProtoMessage</span></code>的结构体指针, XProto的所有消息都继承于该类型.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xplugin-registermsg">
<h5>XPlugin::RegisterMsg<a class="headerlink" href="#xplugin-registermsg" title="永久链接至标题">¶</a></h5>
<div class="section" id="id26">
<h6>定义<a class="headerlink" href="#id26" title="永久链接至标题">¶</a></h6>
<p><strong>void XPlugin::RegisterMsg(const std::string&amp; <em>type</em>, XProtoMessageFunc <em>callback</em>);</strong></p>
</div>
<div class="section" id="id27">
<h6>参数<a class="headerlink" href="#id27" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>const std::string&amp; <em>type</em>: 消息类型字符串.</li>
<li>XProtoMessageFunc <em>callback</em>: 该类型消息的回调函数.</li>
</ul>
</div>
<div class="section" id="id28">
<h6>返回值<a class="headerlink" href="#id28" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id29">
<h6>说明<a class="headerlink" href="#id29" title="永久链接至标题">¶</a></h6>
<p>订阅消息：订阅指定类型的消息. 监听总线, 当指定的消息类型发布时, 调用回调函数.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xplugin-unregistermsg">
<h5>XPlugin::UnRegisterMsg<a class="headerlink" href="#xplugin-unregistermsg" title="永久链接至标题">¶</a></h5>
<div class="section" id="id30">
<h6>定义<a class="headerlink" href="#id30" title="永久链接至标题">¶</a></h6>
<p><strong>void XPlugin::UnRegisterMsg(const std::string&amp; <em>type</em>);</strong></p>
</div>
<div class="section" id="id31">
<h6>参数<a class="headerlink" href="#id31" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>const std::string&amp; <em>type</em>: 消息类型字符串.</li>
</ul>
</div>
<div class="section" id="id32">
<h6>返回值<a class="headerlink" href="#id32" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id33">
<h6>说明<a class="headerlink" href="#id33" title="永久链接至标题">¶</a></h6>
<p>取消消息订阅：取消指定类型消息的订阅. 取消订阅后，plugin将不再接收此类型消息.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xplugin-desc">
<h5>XPlugin::desc<a class="headerlink" href="#xplugin-desc" title="永久链接至标题">¶</a></h5>
<div class="section" id="id34">
<h6>定义<a class="headerlink" href="#id34" title="永久链接至标题">¶</a></h6>
<p><strong>std::string XPlugin::desc() const;</strong></p>
</div>
<div class="section" id="id35">
<h6>参数<a class="headerlink" href="#id35" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id36">
<h6>返回值<a class="headerlink" href="#id36" title="永久链接至标题">¶</a></h6>
<p>描述当前自定义Plugin的字符串.</p>
</div>
<div class="section" id="id37">
<h6>说明<a class="headerlink" href="#id37" title="永久链接至标题">¶</a></h6>
<p>插件描述信息：该接口需要继承<code class="docutils literal notranslate"><span class="pre">XPlugin</span></code>类的自定义Plugin实现该接口定义.</p>
</div>
</div>
</div>
</div>
<div class="section" id="xpluginasync">
<h3>XPluginAsync接口介绍<a class="headerlink" href="#xpluginasync" title="永久链接至标题">¶</a></h3>
<div class="section" id="id38">
<h4>XPluginAsync基础类定义<a class="headerlink" href="#id38" title="永久链接至标题">¶</a></h4>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">XPluginAsync</span> <span class="o">:</span> <span class="k">public</span> <span class="n">XPlugin</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">XPluginAsync</span><span class="p">();</span>
  <span class="k">explicit</span> <span class="nf">XPluginAsync</span><span class="p">(</span><span class="kt">int</span> <span class="n">thread_num</span><span class="p">);</span>
  <span class="o">~</span><span class="n">XPluginAsync</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="c1">// 注册监听消息类型到总线+plugin的初始化</span>
  <span class="kt">int</span> <span class="nf">Init</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
  <span class="kt">int</span> <span class="nf">DeInit</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
  <span class="c1">// 获取plugin当前正在排队处理消息的数量</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">GetPluginMsgCount</span><span class="p">();</span>
  <span class="c1">// plugin处理消息数量限制</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">GetPluginMsgLimit</span><span class="p">();</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">SetPluginMsgLimit</span><span class="p">(</span><span class="kt">int</span> <span class="n">msg_limit_count</span><span class="p">);</span>
  <span class="c1">// plugin处理msg时间预警</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">GetMsgMonitorTime</span><span class="p">();</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">SetMsgMonitorTime</span><span class="p">(</span><span class="kt">int</span> <span class="n">msg_monitor_time</span><span class="p">);</span>

  <span class="c1">// 消息处理上半部分，将消息推送该plugin的消息队列 + 流量控制</span>
  <span class="kt">void</span> <span class="nf">OnMsg</span><span class="p">(</span><span class="n">XProtoMessagePtr</span> <span class="n">msg</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
  <span class="c1">// 启动Plugin</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">Start</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// 停止Plugin</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">Stop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

 <span class="k">protected</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">XProtoMessageFunc</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">(</span><span class="n">XProtoMessagePtr</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="c1">// 重载注册监听消息类型接口，注册时包含异步回调函数</span>
  <span class="kt">void</span> <span class="nf">RegisterMsg</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">type</span><span class="p">,</span> <span class="n">XProtoMessageFunc</span> <span class="n">callback</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">UnRegisterMsg</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">type</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="pluginapi">
<h4>Plugin接口API<a class="headerlink" href="#pluginapi" title="永久链接至标题">¶</a></h4>
<hr class="docutils" />
<div class="section" id="xpluginasync-init">
<h5>XPluginAsync::Init<a class="headerlink" href="#xpluginasync-init" title="永久链接至标题">¶</a></h5>
<div class="section" id="id39">
<h6>定义<a class="headerlink" href="#id39" title="永久链接至标题">¶</a></h6>
<p><strong>int XPluginAsync::Init() override;</strong></p>
</div>
<div class="section" id="id40">
<h6>参数<a class="headerlink" href="#id40" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id41">
<h6>返回值<a class="headerlink" href="#id41" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>0: 成功</li>
<li>非0: 失败</li>
</ul>
</div>
<div class="section" id="id42">
<h6>说明<a class="headerlink" href="#id42" title="永久链接至标题">¶</a></h6>
<p>初始化Plugin：该接口需要继承<code class="docutils literal notranslate"><span class="pre">XPluginAsync</span></code>类的自定义Plugin实现该接口定义. 该接口用来初始化Plugin.
自定义Plugin一般在该接口内调用<em>订阅消息</em>接口.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xpluginasync-start">
<h5>XPluginAsync::Start<a class="headerlink" href="#xpluginasync-start" title="永久链接至标题">¶</a></h5>
<div class="section" id="id43">
<h6>定义<a class="headerlink" href="#id43" title="永久链接至标题">¶</a></h6>
<p><strong>int XPluginAsync::Start();</strong></p>
</div>
<div class="section" id="id44">
<h6>参数<a class="headerlink" href="#id44" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id45">
<h6>返回值<a class="headerlink" href="#id45" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>0: 成功</li>
<li>非0: 失败</li>
</ul>
</div>
<div class="section" id="id46">
<h6>说明<a class="headerlink" href="#id46" title="永久链接至标题">¶</a></h6>
<p>启动Plugin：该接口需要继承<code class="docutils literal notranslate"><span class="pre">XPluginAsync</span></code>类的自定义Plugin实现该接口定义. 该接口用来启动Plugin.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xpluginasync-stop">
<h5>XPluginAsync::Stop<a class="headerlink" href="#xpluginasync-stop" title="永久链接至标题">¶</a></h5>
<div class="section" id="id47">
<h6>定义<a class="headerlink" href="#id47" title="永久链接至标题">¶</a></h6>
<p><strong>int XPluginAsync::Stop();</strong></p>
</div>
<div class="section" id="id48">
<h6>参数<a class="headerlink" href="#id48" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id49">
<h6>返回值<a class="headerlink" href="#id49" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>0: 成功</li>
<li>非0: 失败</li>
</ul>
</div>
<div class="section" id="id50">
<h6>说明<a class="headerlink" href="#id50" title="永久链接至标题">¶</a></h6>
<p>停止Plugin：该接口需要继承<code class="docutils literal notranslate"><span class="pre">XPluginAsync</span></code>类的自定义Plugin实现该接口定义. 该接口用来停止Plugin.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xpluginasync-deinit">
<h5>XPluginAsync::DeInit<a class="headerlink" href="#xpluginasync-deinit" title="永久链接至标题">¶</a></h5>
<div class="section" id="id51">
<h6>定义<a class="headerlink" href="#id51" title="永久链接至标题">¶</a></h6>
<p><strong>int XPluginAsync::DeInit() override;</strong></p>
</div>
<div class="section" id="id52">
<h6>参数<a class="headerlink" href="#id52" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id53">
<h6>返回值<a class="headerlink" href="#id53" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>0: 成功</li>
<li>非0: 失败</li>
</ul>
</div>
<div class="section" id="id54">
<h6>说明<a class="headerlink" href="#id54" title="永久链接至标题">¶</a></h6>
<p>反初始化Plugin：该接口需要继承<code class="docutils literal notranslate"><span class="pre">XPluginAsync</span></code>类的自定义Plugin实现该接口定义. 该接口用来反初始化Plugin.<br />继承自<em>XPluginAsync</em>子plugin类，在完成自己的反初始化任务后，最后需要调用<em>XPluginAsync::DeInit</em>接口以反初始化父类.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xpluginasync-getpluginmsgcount">
<h5>XPluginAsync::GetPluginMsgCount<a class="headerlink" href="#xpluginasync-getpluginmsgcount" title="永久链接至标题">¶</a></h5>
<div class="section" id="id55">
<h6>定义<a class="headerlink" href="#id55" title="永久链接至标题">¶</a></h6>
<p><strong>virtual int GetPluginMsgCount();</strong></p>
</div>
<div class="section" id="id56">
<h6>参数<a class="headerlink" href="#id56" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id57">
<h6>返回值<a class="headerlink" href="#id57" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><em>int</em>: 返回plugin待处理的msg数量</li>
</ul>
</div>
<div class="section" id="id58">
<h6>说明<a class="headerlink" href="#id58" title="永久链接至标题">¶</a></h6>
<p>获取plugin待处理msg数量，用于获取plugin中待处理的msg数量.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xpluginasync-getpluginmsglimit">
<h5>XPluginAsync::GetPluginMsgLimit<a class="headerlink" href="#xpluginasync-getpluginmsglimit" title="永久链接至标题">¶</a></h5>
<div class="section" id="id59">
<h6>定义<a class="headerlink" href="#id59" title="永久链接至标题">¶</a></h6>
<p><strong>virtual int GetPluginMsgLimit();</strong></p>
</div>
<div class="section" id="id60">
<h6>参数<a class="headerlink" href="#id60" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id61">
<h6>返回值<a class="headerlink" href="#id61" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><em>int</em>: 返回plugin处理msg数量上限</li>
</ul>
</div>
<div class="section" id="id62">
<h6>说明<a class="headerlink" href="#id62" title="永久链接至标题">¶</a></h6>
<p>获取plugin处理msg数量上限。</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xpluginasync-setpluginmsglimit">
<h5>XPluginAsync::SetPluginMsgLimit<a class="headerlink" href="#xpluginasync-setpluginmsglimit" title="永久链接至标题">¶</a></h5>
<div class="section" id="id63">
<h6>定义<a class="headerlink" href="#id63" title="永久链接至标题">¶</a></h6>
<p><strong>virtual void SetPluginMsgLimit(int <em>msg_limit_count</em>);</strong></p>
</div>
<div class="section" id="id64">
<h6>参数<a class="headerlink" href="#id64" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>int <em>msg_limit_count</em>: 设置plugin能处理的msg数量上限.</li>
</ul>
</div>
<div class="section" id="id65">
<h6>返回值<a class="headerlink" href="#id65" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id66">
<h6>说明<a class="headerlink" href="#id66" title="永久链接至标题">¶</a></h6>
<p>设置plugin处理msg数量上限。</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xpluginasync-getmsgmonitortime">
<h5>XPluginAsync::GetMsgMonitorTime<a class="headerlink" href="#xpluginasync-getmsgmonitortime" title="永久链接至标题">¶</a></h5>
<div class="section" id="id67">
<h6>定义<a class="headerlink" href="#id67" title="永久链接至标题">¶</a></h6>
<p><strong>virtual int GetMsgMonitorTime();</strong></p>
</div>
<div class="section" id="id68">
<h6>参数<a class="headerlink" href="#id68" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id69">
<h6>返回值<a class="headerlink" href="#id69" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><em>int</em>: msg处理超时时间</li>
</ul>
</div>
<div class="section" id="id70">
<h6>说明<a class="headerlink" href="#id70" title="永久链接至标题">¶</a></h6>
<p>获取msg处理超时时间。</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xpluginasync-setmsgmonitortime">
<h5>XPluginAsync::SetMsgMonitorTime<a class="headerlink" href="#xpluginasync-setmsgmonitortime" title="永久链接至标题">¶</a></h5>
<div class="section" id="id71">
<h6>定义<a class="headerlink" href="#id71" title="永久链接至标题">¶</a></h6>
<p><strong>virtual void SetMsgMonitorTime(int <em>msg_monitor_time</em>);</strong></p>
</div>
<div class="section" id="id72">
<h6>参数<a class="headerlink" href="#id72" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>int <em>msg_monitor_time</em>: msg处理超时时间</li>
</ul>
</div>
<div class="section" id="id73">
<h6>返回值<a class="headerlink" href="#id73" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id74">
<h6>说明<a class="headerlink" href="#id74" title="永久链接至标题">¶</a></h6>
<p>设置msg处理超时时间。</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xpluginasync-pushmsg">
<h5>XPluginAsync::PushMsg<a class="headerlink" href="#xpluginasync-pushmsg" title="永久链接至标题">¶</a></h5>
<div class="section" id="id75">
<h6>定义<a class="headerlink" href="#id75" title="永久链接至标题">¶</a></h6>
<p><strong>void XPluginAsync::PushMsg(XProtoMessagePtr <em>msg</em>);</strong></p>
</div>
<div class="section" id="id76">
<h6>参数<a class="headerlink" href="#id76" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>XProtoMessagePtr <em>msg</em>: 发布到总线的消息.</li>
</ul>
</div>
<div class="section" id="id77">
<h6>返回值<a class="headerlink" href="#id77" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id78">
<h6>说明<a class="headerlink" href="#id78" title="永久链接至标题">¶</a></h6>
<p>发布消息：该接口用来将消息发布到XProto内部总线上，如果消息拥塞，将等待通道畅通后发布消息. 接收一个类型为<code class="docutils literal notranslate"><span class="pre">XProtoMessage</span></code>的结构体指针, XProto的所有消息都继承于该类型.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xpluginasync-trypushmsg">
<h5>XPluginAsync::TryPushMsg<a class="headerlink" href="#xpluginasync-trypushmsg" title="永久链接至标题">¶</a></h5>
<div class="section" id="id79">
<h6>定义<a class="headerlink" href="#id79" title="永久链接至标题">¶</a></h6>
<p><strong>void XPluginAsync::TryPushMsg(XProtoMessagePtr <em>msg</em>);</strong></p>
</div>
<div class="section" id="id80">
<h6>参数<a class="headerlink" href="#id80" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>XProtoMessagePtr <em>msg</em>: 发布到总线的消息.</li>
</ul>
</div>
<div class="section" id="id81">
<h6>返回值<a class="headerlink" href="#id81" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id82">
<h6>说明<a class="headerlink" href="#id82" title="永久链接至标题">¶</a></h6>
<p>发布消息：该接口尝试将消息发布到XProto内部总线上，如果消息拥塞，则丢弃消息立即返回. 接收一个类型为<code class="docutils literal notranslate"><span class="pre">XProtoMessage</span></code>的结构体指针, XProto的所有消息都继承于该类型.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xpluginasync-registermsg">
<h5>XPluginAsync::RegisterMsg<a class="headerlink" href="#xpluginasync-registermsg" title="永久链接至标题">¶</a></h5>
<div class="section" id="id83">
<h6>定义<a class="headerlink" href="#id83" title="永久链接至标题">¶</a></h6>
<p><strong>void XPluginAsync::RegisterMsg(const std::string&amp; <em>type</em>, XProtoMessageFunc <em>callback</em>);</strong></p>
</div>
<div class="section" id="id84">
<h6>参数<a class="headerlink" href="#id84" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>const std::string&amp; <em>type</em>: 消息类型字符串.</li>
<li>XProtoMessageFunc <em>callback</em>: 该类型消息的回调函数.</li>
</ul>
</div>
<div class="section" id="id85">
<h6>返回值<a class="headerlink" href="#id85" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id86">
<h6>说明<a class="headerlink" href="#id86" title="永久链接至标题">¶</a></h6>
<p>订阅消息：订阅指定类型的消息. 监听总线, 当指定的消息类型发布时, 调用回调函数.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xpluginasync-unregistermsg">
<h5>XPluginAsync::UnRegisterMsg<a class="headerlink" href="#xpluginasync-unregistermsg" title="永久链接至标题">¶</a></h5>
<div class="section" id="id87">
<h6>定义<a class="headerlink" href="#id87" title="永久链接至标题">¶</a></h6>
<p><strong>void XPluginAsync::UnRegisterMsg(const std::string&amp; <em>type</em>);</strong></p>
</div>
<div class="section" id="id88">
<h6>参数<a class="headerlink" href="#id88" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>const std::string&amp; <em>type</em>: 消息类型字符串.</li>
</ul>
</div>
<div class="section" id="id89">
<h6>返回值<a class="headerlink" href="#id89" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id90">
<h6>说明<a class="headerlink" href="#id90" title="永久链接至标题">¶</a></h6>
<p>取消消息订阅：取消指定类型消息的订阅. 取消订阅后，plugin将不再接收此类型消息.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="xpluginasync-desc">
<h5>XPluginAsync::desc<a class="headerlink" href="#xpluginasync-desc" title="永久链接至标题">¶</a></h5>
<div class="section" id="id91">
<h6>定义<a class="headerlink" href="#id91" title="永久链接至标题">¶</a></h6>
<p><strong>std::string XPluginAsync::desc() const;</strong></p>
</div>
<div class="section" id="id92">
<h6>参数<a class="headerlink" href="#id92" title="永久链接至标题">¶</a></h6>
<p>无</p>
</div>
<div class="section" id="id93">
<h6>返回值<a class="headerlink" href="#id93" title="永久链接至标题">¶</a></h6>
<p>描述当前自定义Plugin的字符串.</p>
</div>
<div class="section" id="id94">
<h6>说明<a class="headerlink" href="#id94" title="永久链接至标题">¶</a></h6>
<p>插件描述信息：该接口需要继承<code class="docutils literal notranslate"><span class="pre">XPluginAsync</span></code>类的自定义Plugin实现该接口定义.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 2020, Horizon Robotics.

    </p>
  </div>
    
    
    
    利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>